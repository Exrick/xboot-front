webpackJsonp([14],{"4G3j":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=i("3cXf"),a=i.n(s),o=i("uAC3"),r=i.n(o),l=i("VKKs"),n={name:"ownspace_index",data:function(){return{accessToken:{},userForm:{id:"",avatar:"",username:"",mobile:"",email:"",status:"",statusTxt:"",type:"",typeTxt:"",address:"",addressArray:[]},mobileEditForm:{mobile:"",code:""},emailEditForm:{email:""},defaultList:[{url:""}],uploadList:[],viewImage:!1,imgUrl:"",codeError:"",initPhone:"",initEmail:"",uid:"",saveLoading:!1,identifyError:"",savePassLoading:!1,oldPassError:"",identifyCodeRight:!1,hasGetIdentifyCode:!1,canGetIdentifyCode:!1,checkIdentifyCodeLoading:!1,mobileEditValidate:{mobile:[{required:!0,message:"请输入手机号码"},{validator:function(e,t,i){/^1[0-9]{10}$/.test(t)?i():i(new Error("请输入正确格式的手机号"))}}]},emailEditValidate:{email:[{required:!0,message:"请输入邮箱地址"},{type:"email",message:"邮箱格式不正确"}]},editMobileVisible:!1,gettingIdentifyCodeBtnContent:"获取验证码",editEmailVisible:!1,sendVerifyEmailLoading:!1,canSendEditEmail:!0}},methods:{init:function(){this.accessToken={accessToken:Object(l.a)("accessToken")};var e=JSON.parse(r.a.get("userInfo"));e.addressArray=[],this.userForm=e,this.initPhone=e.mobile,this.mobileEditForm.mobile=e.mobile,this.initEmail=e.email,this.emailEditForm.email=e.email,this.defaultList[0].url=e.avatar,null!==e.address&&""!==e.address&&(this.userForm.address=e.address,this.userForm.addressArray=JSON.parse(e.address)),0===this.userForm.type?this.userForm.typeTxt="普通用户":1===this.userForm.type&&(this.userForm.typeTxt="管理员"),0===this.userForm.status?this.userForm.statusTxt="正常状态":-1===this.userForm.status&&(this.userForm.statusTxt="禁用")},handleView:function(e){this.imgUrl=e,this.viewImage=!0},handleRemove:function(e){var t=this.$refs.upload.fileList;this.$refs.upload.fileList.splice(t.indexOf(e),1)},handleSuccess:function(e,t){!0===e.success&&(t.url=e.result,this.userForm.avatar=e.result,this.defaultList[0].url=e.result,this.$refs.upload.fileList.splice(0,1))},handleFormatError:function(e){this.$Notice.warning({title:"不支持的文件格式",desc:"所选文件‘ "+e.name+" ’格式不正确, 请选择 .jpg 或 .png格式文件"})},handleMaxSize:function(e){this.$Notice.warning({title:"文件大小过大",desc:"所选文件‘ "+e.name+" ’大小过大, 不得超过 5M."})},handleBeforeUpload:function(){var e=this.uploadList.length<2;return e||this.$Notice.warning({title:"最多只能上传 1 张图片"}),e},showChangeMobile:function(){this.editMobileVisible=!0},showChangeEmail:function(){this.editEmailVisible=!0},getIdentifyCode:function(){var e=this;this.hasGetIdentifyCode=!0,this.$refs.mobileEditForm.validate(function(t){if(t){e.canGetIdentifyCode=!0;var i=60,s=setInterval(function(){i>=0?(e.gettingIdentifyCodeBtnContent=i+"秒后重试",i-=1):(clearInterval(s),e.gettingIdentifyCodeBtnContent="获取验证码",e.canGetIdentifyCode=!1)},1e3);e.editMobileVisible=!0}})},cancelEditUserInfo:function(){this.$store.commit("removeTag","ownspace_index"),localStorage.pageOpenedList=a()(this.$store.state.app.pageOpenedList);var e="";e=this.$store.state.app.pageOpenedList.length>1?this.$store.state.app.pageOpenedList[1].name:this.$store.state.app.pageOpenedList[0].name,this.$router.push({name:e})},saveEdit:function(){var e=this;this.saveLoading=!0;var t=this.userForm;delete t.nickName,delete t.description,this.postRequest("/user/editOwn",t).then(function(t){e.saveLoading=!1,!0===t.success&&(e.$Message.success("保存成功"),r.a.set("userInfo",e.userForm),e.$store.commit("setAvatarPath",e.userForm.avatar))})},changeAddress:function(){this.userForm.address=a()(this.userForm.addressArray)},cancelInputCodeBox:function(){this.editMobileVisible=!1,this.userForm.mobile=this.initPhone},cancelEditEmail:function(){this.editEmailVisible=!1,this.emailEditForm.email=this.initEmail},submitCode:function(){var e=this;this.checkIdentifyCodeLoading=!0,this.$refs.mobileEditForm.validate(function(t){if(t){if(0===e.mobileEditForm.code.length)return e.codeError="请填写短信验证码",void(e.checkIdentifyCodeLoading=!1);e.$Message.success("修改成功"),e.editMobileVisible=!1,e.checkIdentifyCodeLoading=!1}})},hasChangePhone:function(){var e=this;this.mobileEditForm.mobile===this.initPhone?this.canGetIdentifyCode=!0:this.$refs.mobileEditForm.validate(function(t){e.canGetIdentifyCode=!t})},hasChangeEmail:function(){this.emailEditForm.email===this.initEmail?this.canSendEditEmail=!0:this.canSendEditEmail=!1},sendVerifyEmail:function(){var e=this;this.$refs.emailEditForm.validate(function(t){t&&(e.sendVerifyEmailLoading=!0,setTimeout(function(){e.sendVerifyEmailLoading=!1,e.editEmailVisible=!1,e.$Message.success("发送验证邮件成功，请注意查收")},1e3))})}},mounted:function(){this.uploadList=this.$refs.upload.fileList,this.init(),this.hasChangePhone()}},d={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"own-space"},[i("Card",[i("p",{attrs:{slot:"title"},slot:"title"},[i("Icon",{attrs:{type:"person"}}),e._v("\n            个人信息\n        ")],1),e._v(" "),i("div",[i("Form",{ref:"userForm",attrs:{model:e.userForm,"label-width":100,"label-position":"right"}},[i("FormItem",{attrs:{label:"用户头像："}},[e._l(e.uploadList,function(t){return i("div",{staticClass:"upload-list"},["finished"===t.status?[i("img",{attrs:{src:t.url}}),e._v(" "),i("div",{staticClass:"upload-list-cover"},[i("Icon",{attrs:{type:"ios-eye-outline"},nativeOn:{click:function(i){e.handleView(t.url)}}}),e._v(" "),i("Icon",{attrs:{type:"ios-trash-outline"},nativeOn:{click:function(i){e.handleRemove(t)}}})],1)]:[t.showProgress?i("Progress",{attrs:{percent:t.percentage,"hide-info":""}}):e._e()]],2)}),e._v(" "),i("Upload",{ref:"upload",staticStyle:{display:"inline-block",width:"58px"},attrs:{"show-upload-list":!1,"default-file-list":e.defaultList,"on-success":e.handleSuccess,format:["jpg","jpeg","png"],"max-size":5120,"on-format-error":e.handleFormatError,"on-exceeded-size":e.handleMaxSize,"before-upload":e.handleBeforeUpload,type:"drag",action:"/upload/file",headers:e.accessToken}},[i("div",{staticStyle:{width:"58px",height:"58px","line-height":"58px"}},[i("Icon",{attrs:{type:"camera",size:"20"}})],1)])],2),e._v(" "),i("FormItem",{attrs:{label:"用户姓名："}},[i("span",[e._v(e._s(e.userForm.username))])]),e._v(" "),i("FormItem",{attrs:{label:"手机号："}},[i("span",[e._v(e._s(e.userForm.mobile))]),e._v(" "),i("div",{staticStyle:{display:"inline-block","margin-left":"20px","font-size":"13px"}},[i("a",{on:{click:e.showChangeMobile}},[e._v("修改手机号")])])]),e._v(" "),i("FormItem",{attrs:{label:"邮箱："}},[i("span",[e._v(e._s(e.userForm.email))]),e._v(" "),i("div",{staticStyle:{display:"inline-block","margin-left":"20px","font-size":"13px"}},[i("a",{on:{click:e.showChangeEmail}},[e._v("修改邮箱")])])]),e._v(" "),i("FormItem",{attrs:{label:"地址："}},[i("al-cascader",{staticStyle:{width:"250px"},attrs:{"data-type":"code",level:"2"},on:{"on-change":e.changeAddress},model:{value:e.userForm.addressArray,callback:function(t){e.$set(e.userForm,"addressArray",t)},expression:"userForm.addressArray"}})],1),e._v(" "),i("FormItem",{attrs:{label:"用户类型："}},[i("span",[e._v(e._s(e.userForm.typeTxt))])]),e._v(" "),i("FormItem",{attrs:{label:"用户状态："}},[i("span",[e._v(e._s(e.userForm.statusTxt))])]),e._v(" "),i("FormItem",{attrs:{label:"创建时间："}},[i("span",[e._v(e._s(e.userForm.createTime))])]),e._v(" "),i("FormItem",[i("Button",{staticStyle:{width:"100px"},attrs:{type:"primary",loading:e.saveLoading},on:{click:e.saveEdit}},[e._v("保存")]),e._v(" "),i("Button",{attrs:{type:"ghost"},on:{click:e.cancelEditUserInfo}},[e._v("取消")])],1)],1)],1)]),e._v(" "),i("Modal",{attrs:{title:"修改手机号",closable:!1,"mask-closable":!1,width:500},model:{value:e.editMobileVisible,callback:function(t){e.editMobileVisible=t},expression:"editMobileVisible"}},[i("Form",{ref:"mobileEditForm",attrs:{model:e.mobileEditForm,"label-width":60,rules:e.mobileEditValidate}},[i("FormItem",{attrs:{label:"手机号",prop:"mobile"}},[i("Input",{attrs:{placeholder:"请输入新手机号"},on:{"on-change":e.hasChangePhone},model:{value:e.mobileEditForm.mobile,callback:function(t){e.$set(e.mobileEditForm,"mobile",t)},expression:"mobileEditForm.mobile"}})],1),e._v(" "),i("FormItem",{attrs:{label:"验证码",prop:"code",error:e.codeError}},[i("Input",{staticStyle:{width:"200px"},attrs:{placeholder:"请输入您收到的短信验证码"},model:{value:e.mobileEditForm.code,callback:function(t){e.$set(e.mobileEditForm,"code",t)},expression:"mobileEditForm.code"}}),e._v(" "),i("div",{staticStyle:{display:"inline-block",position:"relative"}},[i("Button",{attrs:{disabled:e.canGetIdentifyCode},on:{click:e.getIdentifyCode}},[e._v(e._s(e.gettingIdentifyCodeBtnContent))])],1)],1)],1),e._v(" "),i("div",{attrs:{slot:"footer"},slot:"footer"},[i("Button",{attrs:{type:"text"},on:{click:e.cancelInputCodeBox}},[e._v("取消")]),e._v(" "),i("Button",{attrs:{type:"primary",loading:e.checkIdentifyCodeLoading},on:{click:e.submitCode}},[e._v("提交")])],1)],1),e._v(" "),i("Modal",{attrs:{title:"修改邮箱",closable:!1,"mask-closable":!1,width:500},model:{value:e.editEmailVisible,callback:function(t){e.editEmailVisible=t},expression:"editEmailVisible"}},[i("Form",{ref:"emailEditForm",attrs:{model:e.emailEditForm,"label-width":90,rules:e.emailEditValidate}},[i("FormItem",{attrs:{label:"新邮箱地址",prop:"email"}},[i("Input",{attrs:{placeholder:"请输入新邮箱地址"},on:{"on-change":e.hasChangeEmail},model:{value:e.emailEditForm.email,callback:function(t){e.$set(e.emailEditForm,"email",t)},expression:"emailEditForm.email"}})],1)],1),e._v(" "),i("div",{attrs:{slot:"footer"},slot:"footer"},[i("Button",{attrs:{type:"text"},on:{click:e.cancelEditEmail}},[e._v("取消")]),e._v(" "),i("Button",{attrs:{type:"primary",disabled:e.canSendEditEmail,loading:e.sendVerifyEmailLoading},on:{click:e.sendVerifyEmail}},[e._v("发送验证邮件")])],1)],1),e._v(" "),i("Modal",{attrs:{title:"图片预览"},model:{value:e.viewImage,callback:function(t){e.viewImage=t},expression:"viewImage"}},[e.viewImage?i("img",{staticStyle:{width:"80%",margin:"0 auto",display:"block"},attrs:{src:e.imgUrl}}):e._e()])],1)},staticRenderFns:[]};var m=i("Z0/y")(n,d,!1,function(e){i("tE5u")},null,null);t.default=m.exports},tE5u:function(e,t){}});
//# sourceMappingURL=14.7427550136c9302e179a.js.map